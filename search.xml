<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[reportlog-2019-02-11]]></title>
    <url>%2F2019%2F02%2F10%2Freportlog-2019-02-11%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-11lines TOP USERSroot 6523admin 245test 195user 78nagios 75ubuntu 66postgres 52oracle 52support 48ftp 43ts3serve 42teamspea 40server 40guest 38student 38git 34hadoop 34user1 34sinusbot 32testuser 32Name: user, dtype: int64 TOP IPS61.177.172.60 2688112.85.42.87 2625112.85.42.238 539112.85.42.229 397193.201.224.158 219115.230.127.27 19619.93.198.104.bc 30139.59.209.158 26132.232.44.85 20186.147.237.51 20101.251.197.238 20204.145.5.2 20ns3064373.ip-188 20sip1.0–0.uk 20p9d935d6f.hyognt 20219.137.226.52 20212.156.115.58 20101.207.248.71 20167.99.180.229 20108.179.205.203 20Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-10]]></title>
    <url>%2F2019%2F02%2F09%2Freportlog-2019-02-10%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-10lines TOP USERSroot 6622admin 385test 107user 88ubnt 48nagios 48ubuntu 38support 37testuser 32ftpuser 32postgres 30adm 30guest 30tomcat 28user1 26oracle 26ftp 25demo 24pi 24student 24Name: user, dtype: int64 TOP IPS112.85.42.87 289261.177.172.60 2169112.85.42.238 911185.246.128.25 667193.201.224.158 450115.230.127.27 434138.197.199.249 20111.166.23.146 20116.68.127.9 2046.44.201.212 20ua-213-112-86-87 20192.ip-145-239-8 19170.130.203.178 19110.74.163.90 1854.37.151.239 12114.71.136.34 10113.160.244.144 10223.ip-164-132-1 1028.ip-51-68-127. 10194.182.86.133 10Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-09]]></title>
    <url>%2F2019%2F02%2F08%2Freportlog-2019-02-09%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-09lines TOP USERSroot 7035admin 17ftpuser 4ubuntu 4applmgr 4jenkins 2cron 2public 2pos 2user 2ftp_test 2ubnt 2postgres 2ftp 2phion 2ethos 2temp 2testuser 2sybase 2test 2Name: user, dtype: int64 TOP IPS112.85.42.87 2659115.230.127.27 2376112.85.42.232 868218.92.1.168 802112.85.42.238 279115.230.127.92 15200.194.15.253 9188.187.52.218 794.51.37.138 6124.197.72.234 6125.105.41.6 631.13.203.237 651.15.213.229 4117.255.216.106 2190-82-73-92.sta 288.214.26.15 258.26.43.39 2ec2-35-157-209-5 2139.59.85.89 2210.203.20.252 2Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-08]]></title>
    <url>%2F2019%2F02%2F07%2Freportlog-2019-02-08%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-08lines TOP USERSroot 9798admin 8nagios 6ubuntu 6david 4postgres 4user 4ubnt 4butter 2castis 2kodi 2qhsuppor 2wp-user 2zabbix 2student 2ftpuser 2oracle 2visitor 2applmgr 2zimbra 2Name: user, dtype: int64 TOP IPS218.92.1.190 2955218.92.1.168 2815112.85.42.87 2584112.85.42.194 868112.85.42.232 307115.230.127.27 242119.28.69.236 7110.179.80.238 6cle60-2-88-173-1 6200.194.15.253 369.66.90.170 3101.91.121.200 2129.213.24.170 2138.97.64.22 288.214.26.15 21.236.151.31 237.114.168.228 2iso.thetank.host 2ec2-34-212-9-227 261.8.136.242 2Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-07]]></title>
    <url>%2F2019%2F02%2F06%2Freportlog-2019-02-07%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-07lines TOP USERSroot 9364admin 194user 37ubnt 35test 29adm 20support 19ftp 13guest 13administ 13nagios 12111111 12default 11operator 101234 10manager 10ftpuser 8pi 8plcmspip 8postgres 6Name: user, dtype: int64 TOP IPS218.92.1.190 5405112.85.42.87 3384193.201.224.158 669112.85.42.194 448123.191.243.30 7d54c1b596.access 7203.220.141.144 7121.159.135.131 727.206.129.57 6d54c12a60.access 6c-68-39-30-29.hs 482.112.32.45 4180.142.104.27 4128.199.221.163 4213.8.182.122 4118.24.18.241 4175.199.164.66 4115.94.103.170 4200.194.15.253 3119.201.214.130 2Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-06]]></title>
    <url>%2F2019%2F02%2F05%2Freportlog-2019-02-06%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-06lines TOP USERSroot 5510admin 40ubuntu 24test 22user 18tomcat 18ftpuser 18usuario 15postgres 12soporte 12student 12nagios 10qhsuppor 8eneida 8system 8git 8ts3 8timemach 8donald 6ts 6Name: user, dtype: int64 TOP IPS112.85.42.87 2896115.230.127.27 1048218.92.1.186 79561.177.172.157 729200.194.15.253 18123.207.241.223 10159.203.179.230 1048.ip-51-38-186. 10179.219.131.55 10104.248.240.130 10190.116.49.2 10noobs.at.lamers. 10206.189.222.38 10ipagstaticip-cb6 10139.59.149.183 10186.96.102.198 10189.124.93.10 1085.172.174.24 10117.73.2.103 10196.218.109.186 10Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-05]]></title>
    <url>%2F2019%2F02%2F04%2Freportlog-2019-02-05%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-05lines TOP USERSroot 4080admin 124test 84postgres 72administ 50teamspea 48support 36nagios 34oracle 34user 32ubuntu 32www 32tomcat 32webmaste 28ts3 26ftp 24suporte 24apache 22student 20sysadmin 20Name: user, dtype: int64 TOP IPS112.85.42.87 2352218.92.1.186 72061.177.172.158 66861.177.172.157 287ip156.ip-178-33- 2047.205.245.164 2094.ip-51-75-253. 20159.203.70.105 20103.248.120.2 20siteuppro.ru 20oc-129-154-85-15 20203.159.249.215 20216.7.159.250 20129.204.38.238 19128.199.216.13 19211.103.154.114 1960-251-146-74.hi 1937.143.150.220 1894.25.38.210 17ns560302.ip-54-3 12Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-04]]></title>
    <url>%2F2019%2F02%2F03%2Freportlog-2019-02-04%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-04lines TOP USERSroot 4740admin 276user 88teamspea 86test 84administ 77www 70nagios 61postgres 56support 48oracle 48ts 40guest 40ts3 36ubuntu 34soporte 34teste 34ubnt 33webmail 32upload 32Name: user, dtype: int64 TOP IPS112.85.42.87 3411115.230.127.27 855188.92.77.235 79761.177.172.158 28649.206.196.254 2885.185.1.226 27132.232.88.200 26111.230.25.17 20244.ip-51-75-120 2090.74.53.130 20189.156.73.246 20128.199.133.201 2023-30-117-166-st 20123.207.160.217 20mail.growthbiz.p 20129.204.65.29 20201.21.202.252 20kd027082000143.p 2088-119-221-196.s 2082.200.226.226.d 20Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-03]]></title>
    <url>%2F2019%2F02%2F02%2Freportlog-2019-02-03%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-03lines TOP USERSroot 2105admin 257test 87user 55mysql 52support 51nagios 48samba 48msn 46iptv 46administ 39www 38ftp 37oracle 34ubnt 34teamspea 32postgres 30student 28ts3 28upload 28Name: user, dtype: int64 TOP IPS112.85.42.87 1318115.230.127.27 822193.201.224.158 668190.210.223.247 20168.62.189.77 20ns3278428.ip-5-3 20207.154.232.160 20209.ip-37-187-19 2046.101.119.15 2045.55.145.31 20116.147.229.35.b 20127.ip-51-38-48. 20142.93.212.66 20189.124.93.10 19infra01.linalis. 19129.204.90.220 19104-189-118-224. 1977.117.61.110.wi 1836.103.245.31 18193.112.160.221 16Name: addr, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[自己搭个小监控]]></title>
    <url>%2F2019%2F02%2F02%2F%E8%87%AA%E5%B7%B1%E6%90%AD%E4%B8%AA%E5%B0%8F%E7%9B%91%E6%8E%A7%2F</url>
    <content type="text"><![CDATA[自己搭个小监控起因搭了个VPS，隔了段时间发现ssh错误日志有点多。 就想怎么看一下都是谁天天搞事情。 /var/log/auth.log -rw-r----- 1 root adm 185827 2月 2 11:09 /var/log/auth.log /var/log/btmp -rw-rw---- 1 root utmp 271488 2月 2 11:09 /var/log/btmp 架构VPS买的是最便宜的单CPU，空间就20GB。所以没有能力搞个大架构T_T，搭个ES基本就做不了别的了。只能自己利用系统功能小搞。 1、 auth.log日志最全，但是正则匹配太复杂，也耗时间。平衡再三，最后用lastb机制把错误登陆日志搞出，在用sed和正则匹配想要的字段生成文件。2、 利用logrotate每次滚动执行命令，拿出日志。3、 利用python脚本，pandas库，产生md文件和图片，生成静态blog文档。4、 用hexo做博客，corntab每天自动执行hexo上传blog到github。 lastb语法: lastb [-adRx][-f &lt;记录文件&gt;][-n &lt;显示列数&gt;][帐号名称…][终端机编号…] 参数说明： -a 把从何处登入系统的主机名称或IP地址显示在最后一行。 -d 将IP地址转换成主机名称。 -f&lt;记录文件&gt; 指定记录文件。 -n&lt;显示列数&gt;或-&lt;显示列数&gt; 设置列出名单的显示列数。 -R 不显示登入系统的主机名称或IP地址。 -x 显示系统关机，重新开机，以及执行等级的改变等信息。 sedlastb -F -f /var/log/btmpdays/btmp.1 | sed -r &apos;s/(.+)\s+ssh:notty\s+(\S+)\s+(.*)-.*/\1---&gt;\2---&gt;\3/g&apos;|sed &apos;$d&apos;|sed &apos;/^$/d&apos; &gt; /tmp/btmp.log 制作分隔符分隔符真的比较讨厌，本来直接用空格做分隔，发现用户名竟然能带空格,最后就用了 &apos;---&gt;&apos; 加多次分隔的方式把日志格式化了。 去掉无用信息btmp日志会多出两行，一个空行和一个btmp信息行，需要去掉。 sed ‘$d’|sed ‘/^$/d’ 日志位置这个日志是中间文件，其实没啥用处，就放到/tmp里面吧。 logrotate/var/log/btmp { missingok daily create 0660 root utmp rotate 7 olddir /var/log/btmpdays/ sharedscripts postrotate lastb -F -f /var/log/btmpdays/btmp.1 | sed -r &apos;s/(.+)\s+ssh:notty\s+(\S+)\s+(.*)-.*/\1---&gt;\2---&gt;\3/g&apos;|sed &apos;$d&apos;|sed &apos;/^$/d&apos; &gt; /tmp/btmp.log python /var/log/btmpdays/totext.py endscript } ### 执行脚本 利用postrotate机制执行命令，需要说的是写上sharedscripts让脚本只执行一次。 python、pandaspandas在linux命令行产生图片有个大坑。需要修改配置文件：Linux中，创建文件 ~/.config/matplotlib/matplotlibrc， （其中，~/.config/matplotlib/是配置文件matplotlibrc的路径）修改一下 backend : Agg。 corntab用户hexo每天执行hexo上传命令 mysql 文件导入一开始想用脚本搞定文件入库，发现日期字段有坑，于是绕过。利用pandas的to_sql，上传数据入库。 dfdb.to_sql(‘btmplog’,engine,if_exists=’append’, index= False)]]></content>
      <tags>
        <tag>supervisor</tag>
        <tag>轮子</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[reportlog-2019-02-02]]></title>
    <url>%2F2019%2F02%2F02%2Freportlog-2019-02-02%2F</url>
    <content type="text"><![CDATA[reportlog-2019-02-02lines TOP USERSroot 1027suporte 12postgres 10admin 10upload 10student 10administ 8deploy 8usuario 8sa 8oracle 8io 6isaque 6nginx 6kz 6lever 6user02 6albertha 6anton 6clodoald 6Name: user, dtype: int64 TOP IPS112.85.42.87 829115.230.127.27 196185.188.218.6 20135.ip-192-99-24 12178.128.115.183 12150.161.8.163 10188.131.181.224 10203.159.249.215 10186.120.93.42 10ec2-52-44-102-36 10190.233.160.141 10crypto.beeone.co 10118.24.126.31 10207.154.232.160 10163.172.169.222 1064.ip-51-254-201 10140.143.93.31 1080.211.236.160 10151.ip-164-132-2 10154.222.138.208 10Name: from, dtype: int64]]></content>
      <categories>
        <category>whocoming</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[index.html]]></title>
    <url>%2F2019%2F01%2F25%2Findex-html%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[test]]></title>
    <url>%2F2019%2F01%2F24%2Ftest%2F</url>
    <content type="text"><![CDATA[hello world again #1 test1 dsafd #2 fdasfasdf sadfdsafsadfsadfasdfasdfsadfasdfasdfasdfas ffdsfasdfsadfsadf ‘’’just a test‘’’]]></content>
      <categories>
        <category>搭建博客</category>
      </categories>
      <tags>
        <tag>test1</tag>
        <tag>test2</tag>
        <tag>test3</tag>
      </tags>
  </entry>
</search>
